<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a73e8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" type="image/x-icon" href="/static/favicon/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/static/favicon/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/favicon/favicon-96x96.png">
    <link rel="apple-touch-icon" href="/static/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <title>百度网盘自动转存工具</title>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- 引入本地资源 -->
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/main.js" defer></script>
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="top-nav">
        <div class="nav-content">
            <div class="nav-left">
                <i class="material-icons">cloud_queue</i>
                <span class="nav-title">百度自动转存</span>
                <span class="version-container">
                    <span class="version" id="app-version"></span>
                    <span class="update-indicator" id="update-indicator"></span>
                </span>
                <a href="https://github.com/kokojacket/baidu-autosave" target="_blank" class="github-link">
                    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
                        <desc>Github Streamline Icon: https://streamlinehq.com</desc>
                        <path d="M7.999933333333333 0.35346666666666665c-1.8616000000000001 0.00006666666666666667 -3.662466666666666 0.6626 -5.080266666666667 1.8689333333333331C1.5017999999999998 3.4287333333333327 0.5594666666666666 5.100266666666666 0.26126666666666665 6.937866666666666c-0.29819999999999997 1.8375333333333332 0.0672 3.7212666666666667 1.0308 5.3141333333333325 0.9635333333333334 1.5927333333333333 2.462466666666667 2.790733333333333 4.228533333333333 3.3795333333333333 0.39199999999999996 0.0686 0.5389999999999999 -0.1666 0.5389999999999999 -0.37239999999999995 0 -0.18619999999999998 -0.0098 -0.8036 -0.0098 -1.4602 -1.9697999999999998 0.36260000000000003 -2.4794 -0.4801333333333333 -2.6361999999999997 -0.9211333333333332 -0.174 -0.4288666666666666 -0.4498 -0.8089333333333333 -0.8036 -1.1074 -0.2744 -0.147 -0.6664 -0.5095999999999999 -0.0098 -0.5194 0.2507333333333333 0.027200000000000002 0.4911333333333333 0.11446666666666666 0.7010000000000001 0.2543333333333333 0.2098 0.13986666666666664 0.3828666666666667 0.3283333333333333 0.5044 0.5492666666666666 0.10719999999999999 0.1926 0.25139999999999996 0.36219999999999997 0.4242666666666666 0.499 0.17286666666666664 0.13679999999999998 0.37106666666666666 0.2382 0.5831999999999999 0.29819999999999997 0.2121333333333333 0.060066666666666664 0.434 0.07773333333333332 0.6529333333333334 0.05193333333333333s0.43066666666666664 -0.09453333333333333 0.6229333333333333 -0.2023333333333333c0.03393333333333333 -0.39859999999999995 0.2116 -0.7712666666666667 0.4998666666666667 -1.0486 -1.7444 -0.19599999999999998 -3.5671999999999997 -0.8722 -3.5671999999999997 -3.8709999999999996 -0.011 -0.7791333333333333 0.27646666666666664 -1.533 0.8036 -2.106933333333333 -0.23966666666666664 -0.6772 -0.21166666666666667 -1.4203999999999999 0.0784 -2.0776 0 0 0.6565333333333333 -0.20579999999999998 2.1559999999999997 0.8036 1.2828 -0.3528 2.6370666666666667 -0.3528 3.9199333333333333 0 1.4993999999999998 -1.0191999999999999 2.1559999999999997 -0.8036 2.1559999999999997 -0.8036 0.29006666666666664 0.6572 0.3181333333333333 1.4003999999999999 0.0784 2.0776 0.5286 0.5729333333333333 0.8164666666666666 1.3275333333333332 0.8036 2.106933333333333 0 3.0086 -1.8325999999999998 3.675 -3.577 3.8709999999999996 0.18706666666666666 0.1896 0.3311333333333333 0.41733333333333333 0.42246666666666666 0.6675333333333333 0.09133333333333334 0.2503333333333333 0.1277333333333333 0.5173333333333333 0.10673333333333332 0.7828666666666666 0 1.0486666666666666 -0.0098 1.8913333333333333 -0.0098 2.1559333333333335 0 0.20579999999999998 0.147 0.4508 0.5389999999999999 0.37239999999999995 1.7629333333333332 -0.5935333333333332 3.2575333333333334 -1.7943333333333333 4.217 -3.3879333333333332 0.9595333333333333 -1.5936666666666666 1.3214 -3.476466666666666 1.0211333333333332 -5.312266666666666 -0.3002666666666667 -1.8357333333333332 -1.2431333333333332 -3.5050666666666666 -2.6604 -4.709933333333333C11.659466666666667 1.0164666666666666 9.860133333333334 0.3544666666666666 7.999933333333333 0.35346666666666665Z" fill="currentColor" stroke-width="0.6667"></path>
                    </svg>
                </a>
            </div>
            <div class="nav-right">
                <span id="current-user">未登录</span>
                <button id="logout-btn" class="btn-icon" onclick="logout()" title="退出登录">
                    <i class="material-icons">exit_to_app</i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <button class="nav-btn active" data-panel="tasks">
                <i class="material-icons">list</i>
                <span>任务管理</span>
            </button>
            <button class="nav-btn" data-panel="users">
                <i class="material-icons">people</i>
                <span>用户管理</span>
            </button>
            <button class="nav-btn" data-panel="settings">
                <i class="material-icons">settings</i>
                <span>系统设置</span>
            </button>
        </aside>

        <!-- 内容面板 -->
        <div class="content-panels">
            <!-- 任务管理面板 -->
            <section id="tasks-panel" class="panel active">
                <div class="panel-header">
                    <div class="operations-bar">
                        <div class="operations-top">
                            <!-- 搜索框 -->
                            <div class="search-box">
                                <i class="material-icons">search</i>
                                <input type="text" class="search-input" placeholder="搜索任务...">
                            </div>
                            <!-- 操作按钮组 -->
                            <div class="action-group">
                                <button class="btn secondary" onclick="selectAllTasks()">
                                    <i class="material-icons">select_all</i>
                                    全选
                                </button>
                                <button class="btn primary" id="add-task-btn">
                                    <i class="material-icons">add</i>
                                    添加任务
                                </button>
                                <button class="btn primary" onclick="executeBatchOperation('execute')" disabled>
                                    <i class="material-icons">play_arrow</i>
                                    批量执行
                                </button>
                                <button class="btn danger" onclick="executeBatchOperation('delete')" disabled>
                                    <i class="material-icons">delete</i>
                                    批量删除
                                </button>
                            </div>
                        </div>
                        <!-- 状态筛选 -->
                        <div class="operations-bottom">
                            <div class="filter-group">
                                <div class="status-filter">
                                    <button class="status-btn active" data-status="all">全部</button>
                                    <button class="status-btn" data-status="normal">正常</button>
                                    <button class="status-btn" data-status="error">异常</button>
                                    <button class="status-btn" data-status="running">执行中</button>
                                </div>
                                <div class="category-filter">
                                    <button class="category-btn active" data-category="all">全部分类</button>
                                    <!-- 分类按钮将通过JavaScript动态添加 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="task-list">
                    <!-- 任务项将通过JavaScript动态添加 -->
                </div>
            </section>

            <!-- 用户管理面板 -->
            <section id="users-panel" class="panel">
                <div class="panel-header">
                    <h2>用户管理</h2>
                    <button class="btn primary" id="add-user-btn">
                        <i class="material-icons">person_add</i>
                        添加用户
                    </button>
                </div>
                <div class="user-list-container">
                    <div class="user-list">
                        <!-- 用户列表将通过JavaScript动态添加 -->
                    </div>
                </div>
            </section>

            <!-- 系统设置面板 -->
            <section id="settings-panel" class="panel">
                <h2>系统设置</h2>
                <div class="settings-form">
                    <!-- 通知设置 -->
                    <div class="form-group">
                        <h3>通知设置</h3>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="notify-enabled" name="notify-enabled">
                            <label for="notify-enabled">启用通知</label>
                        </div>
                        
                        <!-- 动态通知字段 -->
                        <div id="notify-fields-container">
                            <!-- 这里会动态添加通知字段 -->
                        </div>
                        
                        <!-- 快速添加常用通知字段 -->
                        <div class="quick-notify-buttons">
                            <button type="button" id="add-pushplus-token-btn" class="secondary small-btn">
                                添加PUSH_PLUS_TOKEN
                            </button>
                            <button type="button" id="add-pushplus-user-btn" class="secondary small-btn">
                                添加PUSH_PLUS_USER
                            </button>
                            <button type="button" id="add-bark-btn" class="secondary small-btn">
                                添加BARK_PUSH
                            </button>
                        </div>
                        
                        <!-- 添加新通知字段 -->
                        <div class="input-group">
                            <div class="input-row">
                                <input type="text" id="new-notify-key" placeholder="通知字段名称">
                                <input type="text" id="new-notify-value" placeholder="字段值">
                                <button type="button" id="add-notify-field" class="icon-btn">
                                    <i class="material-icons">add</i>
                                </button>
                            </div>
                            <div class="help-text">
                                添加自定义通知字段，常用字段: <br/>
                                PUSH_PLUS_TOKEN - PushPlus的令牌<br/>
                                PUSH_PLUS_USER - PushPlus的群组编码<br/>
                                BARK_PUSH - Bark推送的令牌<br/>
                                更多字段请参考通知模块文档
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button type="button" id="test-notify-btn" class="secondary">
                                测试通知
                            </button>
                        </div>
                    </div>
                    
                    <!-- 定时设置 -->
                    <div class="form-group">
                        <h3>定时设置</h3>
                        <div class="input-group">
                            <label for="global-cron">全局定时规则</label>
                            <input type="text" id="global-cron" name="global-cron" 
                                   placeholder="请输入cron表达式，多个规则用分号(;)分隔">
                            <div class="help-text">
                                示例：0 */4 * * * - 每4小时执行一次<br>
                                */30 * * * * - 每30分钟执行一次<br>
                                多个规则之间使用分号(;)分隔
                            </div>
                        </div>
                    </div>

                    <!-- 网盘容量提醒设置 -->
                    <div class="form-group">
                        <h3>网盘容量提醒</h3>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="quota-alert-enabled" name="quota-alert-enabled">
                            <label for="quota-alert-enabled">启用容量提醒</label>
                        </div>
                        <div class="input-group">
                            <label for="quota-threshold">容量提醒比例 (%)</label>
                            <input type="number" id="quota-threshold" name="quota-threshold" 
                                   min="1" max="99" value="90" placeholder="当使用量超过此比例时发送通知">
                            <div class="help-text">
                                当网盘使用容量超过总容量的设定比例时，系统将发送通知提醒
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="quota-check-schedule">检查时间</label>
                            <input type="text" id="quota-check-schedule" name="quota-check-schedule" 
                                   placeholder="cron表达式，默认每天00:00" value="0 0 * * *">
                            <div class="help-text">
                                使用cron表达式设置检查时间，默认为每天00:00（0 0 * * *）
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分享设置 -->
                    <div class="form-group">
                        <h3>分享设置</h3>
                        <div class="input-group">
                            <label for="default-share-password">默认分享密码</label>
                            <input type="text" id="default-share-password" name="default-share-password" 
                                   maxlength="4" minlength="4" placeholder="请输入4位分享密码" value="1234">
                            <div class="help-text">
                                百度网盘分享密码必须是4个字符
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="default-share-period">默认有效期（天）</label>
                            <input type="number" id="default-share-period" name="default-share-period" 
                                   min="0" max="365" value="7" placeholder="分享链接的有效期，单位为天，0表示永久有效">
                            <div class="help-text">
                                设置分享链接的默认有效期，单位为天，设置为0表示永久有效
                            </div>
                        </div>
                    </div>

                    <!-- 登录凭据设置 -->
                    <div class="form-group">
                        <h3>登录凭据设置</h3>
                        <div class="input-group">
                            <label for="new-username">新用户名</label>
                            <input type="text" id="new-username" name="new-username" 
                                   placeholder="请输入新的用户名">
                        </div>
                        <div class="input-group">
                            <label for="old-password">旧密码</label>
                            <input type="password" id="old-password" name="old-password" 
                                   placeholder="请输入旧密码">
                        </div>
                        <div class="input-group">
                            <label for="new-password">新密码</label>
                            <input type="password" id="new-password" name="new-password" 
                                   placeholder="请输入新密码">
                        </div>
                        <div class="input-group">
                            <label for="confirm-password">确认新密码</label>
                            <input type="password" id="confirm-password" name="confirm-password" 
                                   placeholder="请再次输入新密码">
                        </div>
                        <div class="btn-group">
                            <button type="button" id="update-auth-btn" class="secondary">
                                更新登录凭据
                            </button>
                        </div>
                    </div>
                    
                    <!-- 保存按钮 -->
                    <div class="btn-group">
                        <button type="button" id="save-settings-btn" class="primary">
                            保存设置
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 底部导航栏 -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-panel="tasks">
            <i class="material-icons">list</i>
            <span>任务管理</span>
        </button>
        <button class="nav-btn" data-panel="users">
            <i class="material-icons">people</i>
            <span>用户管理</span>
        </button>
        <button class="nav-btn" data-panel="settings">
            <i class="material-icons">settings</i>
            <span>系统设置</span>
        </button>
    </nav>

    <!-- 任务表单模态框 -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加/编辑任务</h2>
                <button class="close-btn" onclick="hideModal('task-modal')">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <form id="task-form" onsubmit="handleTaskSubmit(event)">
                <!-- 使用task_id作为任务标识 -->
                <input type="hidden" name="task_id">
                
                <div class="form-group">
                    <label>任务名称</label>
                    <input type="text" name="name" placeholder="可选，默认使用分享的文件/文件夹名称">
                    <div class="form-help">用于在任务列表中显示，如不填写则使用分享的文件/文件夹名称</div>
                </div>
                
                <div class="form-group">
                    <label class="required">分享链接</label>
                    <input type="text" name="url" required placeholder="请输入百度网盘分享链接，如果有提取码请直接加在链接后面，例如: https://pan.baidu.com/s/xxx?pwd=1234">
                    <div class="form-help">支持带密码的分享链接，格式：链接?pwd=密码</div>
                </div>
                
                <div class="form-group">
                    <label class="required">保存目录</label>
                    <div class="input-with-dropdown">
                        <input type="text" name="save_dir" required placeholder="请输入保存目录，例如: /downloads">
                        <datalist id="save-dir-list"></datalist>
                        <button type="button" class="dropdown-btn" onclick="toggleSaveDirDropdown()">
                            <i class="material-icons">arrow_drop_down</i>
                        </button>
                        <div id="save-dir-dropdown" class="dropdown-menu"></div>
                    </div>
                    <div class="form-help">目录必须以/开头，可以使用已有目录或创建新目录</div>
                </div>
                
                <div class="form-group">
                    <label>定时规则</label>
                    <div class="input-with-dropdown">
                        <input type="text" name="cron" placeholder="可选，使用cron表达式，例如: */5 * * * *">
                        <datalist id="cron-list"></datalist>
                        <button type="button" class="dropdown-btn" onclick="toggleCronDropdown()">
                            <i class="material-icons">arrow_drop_down</i>
                        </button>
                        <div id="cron-dropdown" class="dropdown-menu"></div>
                    </div>
                    <div class="form-help">留空则使用默认定时规则，支持cron表达式，例如：*/5 * * * * 表示每5分钟执行一次</div>
                </div>
                
                <div class="form-group">
                    <label>分类标签</label>
                    <div class="input-with-dropdown">
                        <input type="text" name="category" placeholder="可选，用于对任务进行分类">
                        <datalist id="category-list"></datalist>
                        <button type="button" class="dropdown-btn" onclick="toggleCategoryDropdown()">
                            <i class="material-icons">arrow_drop_down</i>
                        </button>
                        <div id="category-dropdown" class="dropdown-menu"></div>
                    </div>
                    <div class="form-help">可以给任务添加分类标签，方便管理和筛选</div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn secondary" onclick="hideModal('task-modal')">取消</button>
                    <button type="submit" class="btn primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 用户表单模态框 -->
    <div class="modal" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加用户</h2>
                <button class="close-btn" onclick="hideModal('user-modal')">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <form id="user-form">
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Cookies</label>
                    <textarea name="cookies" required rows="5" placeholder="请输入百度网盘的cookies"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn secondary" onclick="hideModal('user-modal')">取消</button>
                    <button type="submit" class="btn primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 进度日志窗口 -->
    <div id="progress-modal" class="modal">
        <div class="modal-content progress-modal-content">
            <div class="modal-header">
                <h2>任务执行进度</h2>
                <button class="close-btn" onclick="hideModal('progress-modal')">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="progress-log-container">
                <div id="progress-log" class="progress-log"></div>
            </div>
        </div>
    </div>
</body>
</html>