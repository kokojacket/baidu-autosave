const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LoginView-BLLpdKs8.js","./vendor-OArhA24O.js","./element-Ci-NFJgn.js","./LoginView-z0lgvB38.css","./el-input-EA16acr3.css","./DashboardView-DNfkRuPT.js","./DashboardView-D3RIEOcM.css","./el-card-fwQOLwdi.css","./TasksView-DAK15Kke.js","./TasksView-mEZV1BVA.css","./el-dialog-CUwWe0nn.css","./el-switch-DYGDwvK6.css","./UsersView-Cv0zb235.js","./UsersView-BMccdVWu.css","./SettingsView-Bf4LItCj.js","./SettingsView-DmSioxzm.css"])))=>i.map(i=>d[i]);
var je=Object.defineProperty;var Ke=(s,e,t)=>e in s?je(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var z=(s,e,t)=>Ke(s,typeof e!="symbol"?e+"":e,t);import{ax as he,r as I,c as $,ay as He,j as ne,U as ke,y as re,az as $e,aA as K,al as j,z as B,A as E,B as p,R as c,I as q,L as G,u as A,J as d,P as F,E as Y,O as J,Q as pe,a6 as Oe,M as ee,aB as me,h as We,n as Je,T as xe,aC as Qe,aD as Ze,au as Xe}from"./vendor-OArhA24O.js";import{E as Ee,a as Ne,b as ge,c as Ye,d as et,e as tt,f as st,g as Be,h as at,i as ot,j as Le,k as nt,l as rt,o as Ve,m as De,u as qe,n as it,s as Me,p as lt,q as ze,r as ct,t as ut,v as dt}from"./element-Ci-NFJgn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const _ of h.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&a(_)}).observe(document,{childList:!0,subtree:!0});function t(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(n){if(n.ep)return;n.ep=!0;const h=t(n);fetch(n.href,h)}})();class pt{constructor(e){z(this,"baseURL","");z(this,"defaultTimeout",3e4);e&&(this.baseURL=e)}buildURL(e,t){const a=this.baseURL||window.location.origin,n=new URL(e,a);return t&&Object.entries(t).forEach(([h,_])=>{_!=null&&n.searchParams.append(h,String(_))}),n.toString()}async request(e,t={}){const{method:a="GET",headers:n={},params:h,timeout:_=this.defaultTimeout}=t,f=this.buildURL(e,a==="GET"?h:void 0),T=new AbortController,k=setTimeout(()=>T.abort(),_);try{const S={method:a,headers:{"Content-Type":"application/json",...n},credentials:"include",signal:T.signal};a!=="GET"&&h&&(S.body=JSON.stringify(h));const m=await fetch(f,S);if(clearTimeout(k),!m.ok)throw new Error(`HTTP ${m.status}: ${m.statusText}`);const w=m.headers.get("content-type");if(w!=null&&w.includes("application/json"))return await m.json();if(w!=null&&w.includes("text/html"))throw new Error("收到HTML响应，可能需要重新登录");return{success:!0,data:await m.text()}}catch(S){throw clearTimeout(k),S instanceof Error?S.name==="AbortError"?new Error("请求超时"):S:new Error("网络请求失败")}}async get(e,t){return this.request(e,{method:"GET",params:t})}async post(e,t){return this.request(e,{method:"POST",params:t})}async put(e,t){return this.request(e,{method:"PUT",params:t})}async delete(e,t){return this.request(e,{method:"DELETE",params:t})}}const b=new pt;class ft{async getTasks(){return b.get("/api/tasks")}async createTask(e){return b.post("/api/task/add",e)}async updateTask(e,t){return b.post("/api/task/update",{task_id:e,...t})}async deleteTask(e){return b.post("/api/task/delete",{task_id:e})}async executeTask(e){return b.post("/api/task/execute",{task_id:e})}async executeBatchTasks(e){return b.post("/api/tasks/execute-all",{task_ids:e})}async deleteBatchTasks(e){return b.post("/api/tasks/batch-delete",{task_ids:e})}async shareTask(e,t){return b.post("/api/task/share",{task_id:e,...t})}async getShareInfo(e,t){return b.post("/api/share/info",{url:e,pwd:t})}async moveTask(e,t){return b.post("/api/task/move",{task_id:e,new_index:t})}async getUsers(){return b.get("/api/users")}async createUser(e){return b.post("/api/user/add",e)}async updateUser(e){return b.post("/api/user/update",e)}async switchUser(e){return b.post("/api/user/switch",{username:e})}async deleteUser(e){return b.post("/api/user/delete",{username:e})}async getUserQuota(){return b.get("/api/user/quota")}async getUserCookies(e){return b.get(`/api/user/${e}/cookies`)}async getConfig(){return b.get("/api/config")}async updateConfig(e){return b.post("/api/config/update",e)}async testNotify(){return b.post("/api/notify/test")}async addNotifyField(e,t){return b.post("/api/notify/fields",{name:e,value:t})}async deleteNotifyField(e){return b.delete("/api/notify/fields",{name:e})}async updateAuth(e){return b.post("/api/auth/update",e)}async checkVersion(e){return b.get("/api/version/check",{source:e})}async getLogs(e){return b.get("/api/logs",{limit:e})}async getTasksStatus(){return b.get("/api/tasks/status")}async getTaskStatus(e){return b.get(`/api/tasks/${e}/status`)}async login(e,t){return b.post("/api/auth/login",{username:e,password:t})}async logout(){return b.post("/api/auth/logout")}async checkAuth(){return b.get("/api/auth/check")}}const L=new ft;class ht{constructor(){z(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,...t){return this.events[e]?(this.events[e].forEach(a=>a(...t)),!0):!1}off(e,t){if(this.events[e])if(t){const a=this.events[e].indexOf(t);a!==-1&&this.events[e].splice(a,1)}else delete this.events[e]}removeAllListeners(e){e?delete this.events[e]:this.events={}}}class mt extends ht{constructor(){super();z(this,"taskStatusTimer",null);z(this,"logsTimer",null);z(this,"isRunning",!1);z(this,"retryCount",0);z(this,"maxRetries",3);z(this,"config",{taskStatusInterval:5e3,logsInterval:1e4,fastPollingInterval:1e3,retryDelay:3e3})}start(){this.isRunning||(this.isRunning=!0,console.log("启动轮询服务"),this.pollTaskStatus(),this.pollLogs(),this.taskStatusTimer=window.setInterval(()=>{this.pollTaskStatus()},this.config.taskStatusInterval),this.logsTimer=window.setInterval(()=>{this.pollLogs()},this.config.logsInterval),this.emit("started"))}stop(){this.isRunning&&(this.isRunning=!1,console.log("停止轮询服务"),this.taskStatusTimer&&(clearInterval(this.taskStatusTimer),this.taskStatusTimer=null),this.logsTimer&&(clearInterval(this.logsTimer),this.logsTimer=null),this.emit("stopped"))}setFastPolling(t){this.taskStatusTimer&&clearInterval(this.taskStatusTimer);const a=t?this.config.fastPollingInterval:this.config.taskStatusInterval;this.taskStatusTimer=window.setInterval(()=>{this.pollTaskStatus()},a),console.log(`轮询频率已调整为: ${a}ms`)}async pollTaskStatus(){var t;try{const a=await L.getTasksStatus();a.success?(this.emit("task_update",a.tasks||((t=a.data)==null?void 0:t.tasks)||[]),this.retryCount=0):this.handleError("任务状态轮询失败",a.message)}catch(a){this.handleError("任务状态轮询出错",a)}}async pollLogs(){var t;try{const a=await L.getLogs(10);a.success?(this.emit("logs_update",a.logs||((t=a.data)==null?void 0:t.logs)||[]),this.retryCount=0):this.handleError("日志轮询失败",a.message)}catch(a){this.handleError("日志轮询出错",a)}}handleError(t,a){console.error(`${t}:`,a),this.retryCount++,this.retryCount>=this.maxRetries&&(console.log("轮询错误次数过多，暂停轮询"),this.stop(),setTimeout(()=>{this.retryCount=0,this.start()},this.config.retryDelay)),this.emit("error",{context:t,error:a})}isPolling(){return this.isRunning}updateConfig(t){this.config={...this.config,...t},this.isRunning&&(this.stop(),setTimeout(()=>this.start(),100))}}const D=new mt;class gt{constructor(e={}){z(this,"prefix");z(this,"defaultExpiry");this.prefix=e.prefix||"baidu-autosave-",this.defaultExpiry=e.expiry||24*60*60*1e3}getKey(e){return`${this.prefix}${e}`}setItem(e,t,a){const n=this.getKey(e),h=Date.now(),_={data:t,timestamp:h,expiry:h+(a||this.defaultExpiry)};try{localStorage.setItem(n,JSON.stringify(_))}catch(f){console.warn("localStorage存储失败:",f)}}getItem(e){const t=this.getKey(e);try{const a=localStorage.getItem(t);if(!a)return null;const n=JSON.parse(a),h=Date.now();return n.expiry&&h>n.expiry?(this.removeItem(e),null):n.data}catch(a){return console.warn("localStorage读取失败:",a),this.removeItem(e),null}}removeItem(e){const t=this.getKey(e);try{localStorage.removeItem(t)}catch(a){console.warn("localStorage删除失败:",a)}}clear(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(this.prefix)&&localStorage.removeItem(t)})}catch(e){console.warn("localStorage清空失败:",e)}}getAllKeys(){try{return Object.keys(localStorage).filter(t=>t.startsWith(this.prefix)).map(t=>t.replace(this.prefix,""))}catch(e){return console.warn("获取localStorage键列表失败:",e),[]}}hasItem(e){return this.getItem(e)!==null}}const ae={getItem(s){const e=localStorage.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch{return e}},setItem(s,e){const t=typeof e=="string"?e:JSON.stringify(e);localStorage.setItem(s,t)},removeItem(s){localStorage.removeItem(s)},clear(){localStorage.clear()}},Se=new gt({prefix:"baidu-autosave-v2-",expiry:7*24*60*60*1e3});function xs(s){if(s===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,a)).toFixed(2))+" "+t[a]}function vt(s){const e=new Date(s),a=new Date().getTime()-e.getTime();return a<60*1e3?"刚刚":a<60*60*1e3?`${Math.floor(a/6e4)}分钟前`:a<24*60*60*1e3?`${Math.floor(a/36e5)}小时前`:a<7*24*60*60*1e3?`${Math.floor(a/864e5)}天前`:e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function Ls(s,e){let t;return(...a)=>{clearTimeout(t),t=window.setTimeout(()=>s(...a),e)}}function _t(s,e){const t=f=>{if(f==="latest")return"999.999.999";const T=f.match(/(?:Release\s+)?(v?\d+\.\d+\.\d+)/i);let k=f;return T&&(k=T[1]),k.replace(/^v/i,"")},a=t(s),n=t(e),h=a.split(".").map(Number),_=n.split(".").map(Number);for(let f=0;f<3;f++){const T=(h[f]||0)-(_[f]||0);if(T!==0)return T}return 0}function P(s){return s instanceof Error?s.message:typeof s=="string"?s:s&&typeof s=="object"&&"message"in s?String(s.message):"未知错误"}function Rs(s){return{normal:"正常",error:"错误",running:"运行中",success:"成功"}[s]||s}function fe(){return window.innerWidth<1200}const ve=he("auth",()=>{const s=I(!1),e=I(""),t=I(!1),a=I(null),n=$(()=>s.value&&e.value),h=async(m,w)=>{t.value=!0,a.value=null;try{const l=await L.login(m,w);if(l.success)return s.value=!0,e.value=m,ae.setItem("auth",{isAuthenticated:!0,username:m}),!0;throw new Error(l.message||"登录失败")}catch(l){throw a.value=P(l),l}finally{t.value=!1}},_=async()=>{try{await L.logout()}catch(m){console.warn("登出接口调用失败:",m)}finally{s.value=!1,e.value="",ae.removeItem("auth")}},f=async()=>{var m;try{const w=await L.checkAuth();return w.success?(s.value=!0,(w.username||(m=w.data)!=null&&m.username)&&(e.value=w.username||w.data.username),!0):(s.value=!1,e.value="",ae.removeItem("auth"),!1)}catch(w){return console.error("检查认证状态失败:",w),s.value=!1,e.value="",ae.removeItem("auth"),!1}};return{isAuthenticated:s,username:e,loading:t,error:a,isLoggedIn:n,login:h,logout:_,checkAuth:f,updatePassword:async(m,w)=>{try{const l=await L.updateAuth({username:e.value,password:w,old_password:m});if(l.success)return!0;throw new Error(l.message||"更新密码失败")}catch(l){throw a.value=P(l),l}},initAuth:async()=>{const m=ae.getItem("auth");m!=null&&m.isAuthenticated&&m.username&&await f()&&(s.value=!0,e.value=m.username)},clearError:()=>{a.value=null}}}),ue={NORMAL:"normal",ERROR:"error",RUNNING:"running",SUCCESS:"success"},oe={LOGIN:"登录",DASHBOARD:"仪表盘",TASKS:"任务管理",USERS:"用户管理",SETTINGS:"系统设置"},Te=he("tasks",()=>{const s=I([]),e=I(!1),t=I(null),a=I(new Set),n=$(()=>{const i={normal:[],error:[],running:[],success:[]};return s.value.forEach(r=>{const u=r.status;i[u]&&i[u].push(r)}),i}),h=$(()=>{const i=new Set;return s.value.forEach(r=>{r.category&&i.add(r.category)}),Array.from(i)}),_=$(()=>{const i=new Set;return s.value.forEach(r=>{r.save_dir&&i.add(r.save_dir)}),Array.from(i)}),f=$(()=>{const i=new Set;return s.value.forEach(r=>{r.cron&&i.add(r.cron)}),Array.from(i)}),T=$(()=>{const i=new Set;return s.value.forEach(r=>{r.regex_pattern&&i.add(r.regex_pattern)}),Array.from(i)}),k=$(()=>{const i=new Set;return s.value.forEach(r=>{r.regex_replace&&i.add(r.regex_replace)}),Array.from(i)}),S=$(()=>{if(s.value.length===0)return"";const i=s.value.reduce((U,C)=>C.order>U.order?C:U);if(!i.save_dir)return"";const r=i.save_dir.split("/").filter(U=>U.length>0);r.pop();const u=r.join("/");return u?`/${u}`:""}),m=$(()=>{const i={total:s.value.length,normal:0,error:0,running:0,success:0};return s.value.forEach(r=>{const u=r.status;i.hasOwnProperty(u)&&i[u]++}),i}),w=$(()=>s.value.filter(i=>a.value.has(i.order))),l=async()=>{var i;e.value=!0,t.value=null;try{const r=await L.getTasks();if(r.success){const u=r.tasks||((i=r.data)==null?void 0:i.tasks)||[];s.value=u.sort((U,C)=>(U.order||0)-(C.order||0))}else throw new Error(r.message||"获取任务列表失败")}catch(r){t.value=P(r),console.error("获取任务列表失败:",r)}finally{e.value=!1}};return{tasks:s,loading:e,error:t,selectedTaskIds:a,tasksByStatus:n,taskCategories:h,taskSavePaths:_,taskCronRules:f,taskRegexPatterns:T,taskRegexReplaces:k,getDefaultSavePath:S,taskStats:m,selectedTasks:w,fetchTasks:l,addTask:async i=>{try{const r=await L.createTask(i);if(r.success)return await l(),!0;throw new Error(r.message||"添加任务失败")}catch(r){throw t.value=P(r),r}},updateTask:async(i,r)=>{try{const u=await L.updateTask(i,r);if(u.success)return await l(),!0;throw new Error(u.message||"更新任务失败")}catch(u){throw t.value=P(u),u}},deleteTask:async i=>{try{const r=await L.deleteTask(i);if(r.success)return await l(),a.value.delete(i),!0;throw new Error(r.message||"删除任务失败")}catch(r){throw t.value=P(r),r}},executeTask:async i=>{try{const r=s.value.find(U=>U.order===i);r&&(r.status=ue.RUNNING,r.message="正在执行...");const u=await L.executeTask(i);if(!u.success)throw new Error(u.message||"执行任务失败");return!0}catch(r){const u=s.value.find(U=>U.order===i);throw u&&(u.status=ue.ERROR,u.message=P(r)),t.value=P(r),r}},executeBatchTasks:async i=>{var r;try{i.forEach(U=>{const C=s.value.find(V=>V.order===U);C&&(C.status=ue.RUNNING,C.message="正在执行...")});const u=await L.executeBatchTasks(i);if(u.success)return u.results||((r=u.data)==null?void 0:r.results);throw new Error(u.message||"批量执行任务失败")}catch(u){throw i.forEach(U=>{const C=s.value.find(V=>V.order===U);C&&(C.status=ue.ERROR,C.message=P(u))}),t.value=P(u),u}},deleteBatchTasks:async i=>{try{const r=await L.deleteBatchTasks(i);if(r.success)return await l(),i.forEach(u=>a.value.delete(u)),!0;throw new Error(r.message||"批量删除任务失败")}catch(r){throw t.value=P(r),r}},shareTask:async(i,r)=>{var u,U;try{const C=await L.shareTask(i,r);if(C.success){const V=s.value.find(Ge=>Ge.order===i);return V&&(V.share_info=C.share_info||((u=C.data)==null?void 0:u.share_info)),C.share_info||((U=C.data)==null?void 0:U.share_info)}else throw new Error(C.message||"生成分享链接失败")}catch(C){throw t.value=P(C),C}},moveTask:async(i,r)=>{try{const u=await L.moveTask(i,r);if(u.success)return await l(),!0;throw new Error(u.message||"移动任务失败")}catch(u){throw t.value=P(u),u}},handleTaskUpdate:i=>{const r=i.sort((u,U)=>(u.order||0)-(U.order||0));s.value=r},selectTask:i=>{a.value.add(i)},unselectTask:i=>{a.value.delete(i)},selectAllTasks:()=>{s.value.forEach(i=>{a.value.add(i.order)})},clearSelection:()=>{a.value.clear()},toggleTaskSelection:i=>{a.value.has(i)?a.value.delete(i):a.value.add(i)},updateTaskStatus:(i,r,u)=>{const U=s.value.find(C=>C.order===i);U&&(U.status=r,u!==void 0&&(U.message=u))},updateTaskProgress:(i,r)=>{const u=s.value.find(U=>U.order===i);u&&(u.progress=r)},clearError:()=>{t.value=null}}}),_e=he("users",()=>{const s=I([]),e=I(""),t=I(null),a=I(!1),n=I(null),h=$(()=>s.value.find(g=>g.is_current)||null),_=$(()=>s.value.filter(g=>g.cookies_valid!==!1)),f=$(()=>s.value.filter(g=>g.cookies_valid===!1)),T=$(()=>({total:s.value.length,valid:_.value.length,invalid:f.value.length})),k=async()=>{var g,o;a.value=!0,n.value=null;try{const v=await L.getUsers();if(v.success)s.value=v.users||((g=v.data)==null?void 0:g.users)||[],e.value=v.current_user||((o=v.data)==null?void 0:o.current_user)||"";else throw new Error(v.message||"获取用户列表失败")}catch(v){n.value=P(v),console.error("获取用户列表失败:",v)}finally{a.value=!1}},S=async()=>{var g;try{const o=await L.getUserQuota();if(o.success)t.value=o.quota||((g=o.data)==null?void 0:g.quota)||o.data;else throw new Error(o.message||"获取用户配额失败")}catch(o){n.value=P(o),console.error("获取用户配额失败:",o)}},m=async g=>{try{const o=await L.createUser(g);if(o.success)return await k(),!0;throw new Error(o.message||"添加用户失败")}catch(o){throw n.value=P(o),o}},w=async g=>{try{const o=await L.updateUser(g);if(o.success)return await k(),!0;throw new Error(o.message||"更新用户失败")}catch(o){throw n.value=P(o),o}},l=async g=>{try{const o=await L.deleteUser(g);if(o.success)return await k(),!0;throw new Error(o.message||"删除用户失败")}catch(o){throw n.value=P(o),o}},x=async g=>{try{const o=await L.switchUser(g);if(o.success)return s.value.forEach(v=>{v.is_current=v.username===g}),e.value=g,await S(),!0;throw new Error(o.message||"切换用户失败")}catch(o){throw n.value=P(o),o}},y=async g=>{var o;try{const v=await L.getUserCookies(g);if(v.success)return v.cookies||((o=v.data)==null?void 0:o.cookies);throw new Error(v.message||"获取用户Cookies失败")}catch(v){throw n.value=P(v),v}},O=g=>s.value.find(o=>o.username===g);return{users:s,currentUser:e,userQuota:t,loading:a,error:n,currentUserInfo:h,validUsers:_,invalidUsers:f,userStats:T,fetchUsers:k,fetchUserQuota:S,addUser:m,updateUser:w,deleteUser:l,switchUser:x,getUserCookies:y,findUserByUsername:O,isCurrentUser:g=>e.value===g,updateUserStatus:(g,o)=>{const v=O(g);v&&(v.cookies_valid=o,v.last_active=o?new Date().toISOString():v.last_active)},clearError:()=>{n.value=null},init:async()=>{await k(),await S()}}}),be={APP_VERSION:"v1.1.3",BUILD_TIME:"2024-09-15T20:00:00Z",RELEASE_NOTES:"前端重构版本 - Vue 3 + TypeScript"},Ae=be.APP_VERSION,Ps=be.BUILD_TIME,$s=be.RELEASE_NOTES,Ie=he("version",()=>{const s=I(Ae),e=I(""),t=I(!1),a=I(!1),n=I(0),h=I(null),_=async()=>{var m,w;const S=Date.now();if(!a.value){if(n.value&&S-n.value<18e5){console.log("版本检查缓存有效，跳过检查");return}a.value=!0;try{const l=["github","dockerhub","dockerhub_alt","msrun","1ms"];for(const x of l)try{const y=await L.checkVersion(x);if(y.success&&y.version){e.value=y.version,t.value=_t(y.version,s.value)>0,n.value=S,t.value&&(console.log(`发现新版本: ${y.version}，当前版本: ${s.value}`),h.value={version:y.version,link:y.link||((m=y.data)==null?void 0:m.link),notes:y.release_notes||((w=y.data)==null?void 0:w.release_notes)});break}}catch(y){console.warn(`从${x}获取版本信息失败:`,P(y));continue}}catch(l){console.error("版本检查失败:",P(l))}finally{a.value=!1}}};return{currentVersion:s,latestVersion:e,hasUpdate:t,checking:a,updateInfo:h,lastCheckTime:n,checkForUpdates:_,resetVersionCheck:()=>{e.value="",t.value=!1,h.value=null,n.value=0},initVersionCheck:()=>{setTimeout(()=>{_()},3e3)}}}),wt=He(),de=I(!1),ye=I(null);function Ue(){const s=$(()=>de.value),e=$(()=>ye.value),t=()=>{D.start()},a=()=>{D.stop()},n=l=>{D.setFastPolling(l)},h=l=>{D.on("task_update",l)},_=l=>{D.on("logs_update",l)},f=l=>{D.on("error",l)},T=l=>{D.off("task_update",l)},k=l=>{D.off("logs_update",l)},S=l=>{D.off("error",l)},m=()=>D.isPolling(),w=l=>{D.updateConfig(l)};return ne(()=>{D.on("started",()=>{de.value=!0,ye.value=null,console.log("轮询服务已启动")}),D.on("stopped",()=>{de.value=!1,console.log("轮询服务已停止")}),D.on("error",l=>{ye.value=l.error instanceof Error?l.error.message:"轮询错误",console.error("轮询错误:",l)}),de.value=D.isPolling(),t()}),ke(()=>{D.removeAllListeners(),a()}),{isRunning:s,error:e,start:t,stop:a,setFastPolling:n,onTaskUpdate:h,onLogsUpdate:_,onError:f,offTaskUpdate:T,offLogsUpdate:k,offError:S,getPollingStatus:m,updatePollingConfig:w}}const Fe=""+new URL("../favicon/favicon.svg",import.meta.url).href,yt={class:"app-header"},kt={class:"header-content"},St={class:"header-right"},Et={class:"version-text"},Tt={class:"polling-status"},bt={class:"user-info"},At={class:"username"},It={class:"notification-content"},Ut={key:0,class:"empty-notifications"},Ct={key:1,class:"notification-list"},xt={class:"notification-icon"},Lt={class:"notification-body"},Rt={class:"notification-title"},Pt={class:"notification-message"},$t={class:"notification-time"},Ot=re({__name:"AppHeader",setup(s){const e=$e(),t=ve(),a=_e(),n=Ie(),{currentUser:h}=K(a),{hasUpdate:_}=K(n),{isRunning:f}=Ue(),T=()=>{n.checkForUpdates()},k=I(fe()),S=I(!1),m=I(0),w=I([]),l=async()=>{try{await ot.confirm("确定要退出登录吗？","确认退出",{confirmButtonText:"退出",cancelButtonText:"取消",type:"warning"}),await t.logout(),Le.success("已退出登录"),await e.push("/login")}catch(M){M!=="cancel"&&Le.error("退出登录失败")}},x=()=>{e.push("/users")},y=()=>{e.push("/settings")},O=M=>({success:"#67c23a",warning:"#e6a23c",error:"#f56c6c",info:"#409eff"})[M]||"#909399",N=M=>({success:"Check",warning:"Warning",error:"Close",info:"InfoFilled"})[M]||"Bell",H=()=>{k.value=fe()};return ne(()=>(window.addEventListener("resize",H),()=>{window.removeEventListener("resize",H)})),(M,R)=>{const g=Ee,o=j("Connection"),v=ge,Z=Ne,W=j("User"),te=et,se=j("ArrowDown"),X=st,le=j("Setting"),ce=j("SwitchButton"),i=tt,r=Ye,u=j("Bell"),U=Be,C=at;return E(),B("header",yt,[p("div",kt,[R[5]||(R[5]=p("div",{class:"header-left"},[p("div",{class:"logo-area"},[p("img",{src:Fe,alt:"Logo",class:"app-logo"}),p("h1",{class:"app-title"},"百度网盘自动转存")])],-1)),p("div",St,[p("div",{class:"version-info",onClick:T},[c(g,{"is-dot":A(_),type:"warning"},{default:d(()=>[p("span",Et,F(A(Ae)),1)]),_:1},8,["is-dot"])]),p("div",Tt,[c(Z,{content:A(f)?"轮询运行中":"轮询已停止"},{default:d(()=>[c(v,{class:Y(["polling-icon",{active:A(f),inactive:!A(f)}]),size:"16"},{default:d(()=>[c(o)]),_:1},8,["class"])]),_:1},8,["content"])]),A(h)?(E(),q(r,{key:0,trigger:"click",class:"user-dropdown"},{dropdown:d(()=>[c(i,null,{default:d(()=>[c(X,{onClick:x},{default:d(()=>[c(v,null,{default:d(()=>[c(W)]),_:1}),R[2]||(R[2]=J(" 用户管理 ",-1))]),_:1}),c(X,{onClick:y},{default:d(()=>[c(v,null,{default:d(()=>[c(le)]),_:1}),R[3]||(R[3]=J(" 系统设置 ",-1))]),_:1}),c(X,{divided:"",onClick:l},{default:d(()=>[c(v,null,{default:d(()=>[c(ce)]),_:1}),R[4]||(R[4]=J(" 退出登录 ",-1))]),_:1})]),_:1})]),default:d(()=>[p("div",bt,[c(te,{size:32,class:"user-avatar"},{default:d(()=>[c(v,null,{default:d(()=>[c(W)]),_:1})]),_:1}),p("span",At,F(A(h)),1),c(v,{class:"dropdown-arrow"},{default:d(()=>[c(se)]),_:1})])]),_:1})):G("",!0),c(U,{type:"text",class:"notification-btn",onClick:R[0]||(R[0]=V=>S.value=!0)},{default:d(()=>[c(g,{value:m.value,hidden:m.value===0,max:99},{default:d(()=>[c(v,{size:"18"},{default:d(()=>[c(u)]),_:1})]),_:1},8,["value","hidden"])]),_:1})])]),c(C,{modelValue:S.value,"onUpdate:modelValue":R[1]||(R[1]=V=>S.value=V),title:"通知中心",direction:"rtl",size:"320px",class:"notification-drawer"},{default:d(()=>[p("div",It,[w.value.length===0?(E(),B("div",Ut,[c(v,{size:"48",color:"#c0c4cc"},{default:d(()=>[c(u)]),_:1}),R[6]||(R[6]=p("p",null,"暂无通知",-1))])):(E(),B("div",Ct,[(E(!0),B(pe,null,Oe(w.value,V=>(E(),B("div",{key:V.id,class:Y(["notification-item",{unread:!V.read}])},[p("div",xt,[c(v,{color:O(V.type)},{default:d(()=>[(E(),q(ee(N(V.type))))]),_:2},1032,["color"])]),p("div",Lt,[p("h4",Rt,F(V.title),1),p("p",Pt,F(V.message),1),p("span",$t,F(A(vt)(V.time)),1)])],2))),128))]))])]),_:1},8,["modelValue"])])}}}),we=(s,e)=>{const t=s.__vccOpts||s;for(const[a,n]of e)t[a]=n;return t},Re=we(Ot,[["__scopeId","data-v-b8d1d721"]]),Nt={class:"sidebar-content"},Bt={class:"sidebar-header"},Vt={key:0,class:"header-content"},Dt={class:"sidebar-nav"},qt={class:"sidebar-footer"},Mt={key:0,class:"system-status"},zt={class:"status-item"},Ft={key:0,class:"status-item"},Gt={class:"status-value user-name"},jt={key:1,class:"quota-info"},Kt={class:"quota-text"},Ht={class:"quota-used"},Wt={class:"quota-total"},Jt={class:"quick-actions"},Qt={key:0},Zt={key:1,class:"version-section"},Xt={class:"version-number"},Yt={key:0,class:"update-notice"},es=re({__name:"AppSidebar",emits:["add-task"],setup(s,{emit:e}){const t=e,a=$e(),n=me(),h=Te(),_=_e(),f=Ie(),{taskStats:T}=K(h),{userStats:k,currentUser:S,userQuota:m}=K(_),{hasUpdate:w}=K(f),{isRunning:l}=Ue(),x=()=>{f.checkForUpdates()},y=I(!1),O=$(()=>n.path),N=$(()=>m.value?Math.round(m.value.used/m.value.total*100):0),H=()=>{y.value=!y.value,Se.setItem("sidebar-collapsed",y.value)},M=g=>{a.push(g)},R=()=>{t("add-task")};return We(()=>n.path,g=>{}),ne(()=>{const g=Se.getItem("sidebar-collapsed");g!==null&&(y.value=g);const o=()=>{window.innerWidth<1200&&(y.value=!0)};return o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}}),(g,o)=>{const v=ge,Z=Be,W=rt,te=Ee,se=it,X=nt,le=lt,ce=Ne;return E(),B("aside",{class:Y(["app-sidebar",{collapsed:y.value}])},[p("div",Nt,[p("div",Bt,[y.value?G("",!0):(E(),B("div",Vt,[...o[0]||(o[0]=[p("img",{src:Fe,alt:"Logo",class:"sidebar-logo"},null,-1),p("h2",{class:"sidebar-title"},"自动转存",-1)])])),c(Z,{type:"text",class:"collapse-btn",onClick:H},{default:d(()=>[c(v,null,{default:d(()=>[(E(),q(ee(y.value?"Expand":"Fold")))]),_:1})]),_:1})]),p("nav",Dt,[c(X,{"default-active":O.value,collapse:y.value,"unique-opened":!1,class:"sidebar-menu",onSelect:M},{default:d(()=>[c(W,{index:"/dashboard",class:"menu-item"},{title:d(()=>[...o[1]||(o[1]=[J("仪表盘",-1)])]),default:d(()=>[c(v,null,{default:d(()=>[c(A(Ve))]),_:1})]),_:1}),c(W,{index:"/tasks",class:"menu-item"},{title:d(()=>[o[2]||(o[2]=p("span",null,"任务管理",-1)),A(T).running>0?(E(),q(te,{key:0,value:A(T).running,max:99,class:"menu-badge"},null,8,["value"])):G("",!0)]),default:d(()=>[c(v,null,{default:d(()=>[c(A(De))]),_:1})]),_:1}),c(W,{index:"/users",class:"menu-item"},{title:d(()=>[o[3]||(o[3]=p("span",null,"用户管理",-1)),A(k).invalid>0?(E(),q(se,{key:0,type:"danger",size:"small",class:"menu-tag"},{default:d(()=>[J(F(A(k).invalid),1)]),_:1})):G("",!0)]),default:d(()=>[c(v,null,{default:d(()=>[c(A(qe))]),_:1})]),_:1}),c(W,{index:"/settings",class:"menu-item"},{title:d(()=>[...o[4]||(o[4]=[J("系统设置",-1)])]),default:d(()=>[c(v,null,{default:d(()=>[c(A(Me))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),p("div",qt,[y.value?G("",!0):(E(),B("div",Mt,[p("div",zt,[o[5]||(o[5]=p("span",{class:"status-label"},"轮询状态",-1)),c(se,{type:A(l)?"success":"danger",size:"small",class:"status-value"},{default:d(()=>[J(F(A(l)?"运行中":"已停止"),1)]),_:1},8,["type"])]),A(S)?(E(),B("div",Ft,[o[6]||(o[6]=p("span",{class:"status-label"},"当前用户",-1)),p("span",Gt,F(A(S)),1)])):G("",!0),A(m)?(E(),B("div",jt,[p("div",Kt,[o[7]||(o[7]=p("span",{class:"quota-label"},"存储空间",-1)),p("span",Ht,F(A(m).used_formatted),1),o[8]||(o[8]=p("span",{class:"quota-divider"},"/",-1)),p("span",Wt,F(A(m).total_formatted),1)]),c(le,{percentage:N.value,"stroke-width":4,"show-text":!1,class:"quota-progress"},null,8,["percentage"])])):G("",!0)])),p("div",Jt,[c(ce,{content:"添加任务",disabled:!y.value},{default:d(()=>[c(Z,{type:"primary",icon:A(ze),class:Y({"collapsed-btn":y.value}),onClick:R},{default:d(()=>[y.value?G("",!0):(E(),B("span",Qt,"添加任务"))]),_:1},8,["icon","class"])]),_:1},8,["disabled"])]),y.value?G("",!0):(E(),B("div",Zt,[p("div",{class:"version-item",onClick:x},[o[9]||(o[9]=p("span",{class:"version-label"},"版本",-1)),c(te,{"is-dot":A(w),type:"warning"},{default:d(()=>[p("span",Xt,F(A(Ae)),1)]),_:1},8,["is-dot"])]),A(w)?(E(),B("div",Yt,[c(Z,{type:"text",size:"small",onClick:x},{default:d(()=>[c(v,null,{default:d(()=>[c(A(ct))]),_:1}),o[10]||(o[10]=J(" 发现新版本 ",-1))]),_:1})])):G("",!0)]))])])],2)}}}),ts=we(es,[["__scopeId","data-v-b4cfb81a"]]),ss={class:"app-bottom-nav"},as={class:"nav-content"},os={class:"nav-icon"},ns={class:"nav-label"},rs={class:"nav-icon add-icon"},is=re({__name:"AppBottomNav",emits:["add-task"],setup(s,{emit:e}){const t=e,a={Odometer:Ve,List:De,User:qe,Setting:Me},n=me(),h=Te(),_=_e(),{taskStats:f}=K(h),{userStats:T}=K(_),k=$(()=>[{path:"/dashboard",icon:"Odometer",label:"首页",badge:0},{path:"/tasks",icon:"List",label:"任务",badge:f.value.running},{path:"/users",icon:"User",label:"用户",badge:T.value.invalid},{path:"/settings",icon:"Setting",label:"设置",badge:0}]),S=w=>n.path===w||w!=="/"&&n.path.startsWith(w),m=()=>{t("add-task")};return(w,l)=>{const x=ge,y=Ee,O=j("router-link");return E(),B("nav",ss,[p("div",as,[(E(!0),B(pe,null,Oe(k.value,N=>(E(),q(O,{key:N.path,to:N.path,class:Y(["nav-item",{active:S(N.path)}])},{default:d(()=>[p("div",os,[N.badge&&N.badge>0?(E(),q(y,{key:0,value:N.badge,max:99,hidden:!1},{default:d(()=>[c(x,{size:"20"},{default:d(()=>[(E(),q(ee(a[N.icon])))]),_:2},1024)]),_:2},1032,["value"])):(E(),q(x,{key:1,size:"20"},{default:d(()=>[(E(),q(ee(a[N.icon])))]),_:2},1024))]),p("span",ns,F(N.label),1)]),_:2},1032,["to","class"]))),128)),p("div",{class:"nav-item add-btn",onClick:m},[p("div",rs,[c(x,{size:"24"},{default:d(()=>[c(A(ze))]),_:1})]),l[0]||(l[0]=p("span",{class:"nav-label"},"添加",-1))])]),l[1]||(l[1]=p("div",{class:"safe-area-padding"},null,-1))])}}}),ls=we(is,[["__scopeId","data-v-bdd761a7"]]),cs={class:"main-wrapper"},us={class:"main-content"},ds={class:"content-container"},ps={class:"mobile-main-content"},fs={class:"mobile-content-container"},hs={key:2,class:"global-loading"},ms=re({__name:"AppLayout",setup(s){const e=me(),t=ve(),a=Te(),n=_e();Ue();const{loading:h}=K(t),{loading:_}=K(a),{loading:f}=K(n),T=I(fe()),k=I(!1),S=$(()=>h.value||_.value||f.value),m=()=>{window.dispatchEvent(new CustomEvent("global-add-task"))},w=O=>{k.value=O},l=()=>{const O=fe();O!==T.value&&(T.value=O)},x=async()=>{try{await Promise.all([a.fetchTasks(),n.init()])}catch(O){console.error("应用初始化失败:",O)}};ne(async()=>{const O=Se.getItem("sidebar-collapsed");O!==null&&(k.value=O),window.addEventListener("resize",l),await Je(),await x()}),ke(()=>{window.removeEventListener("resize",l)});const y=e&&(()=>null);return ke(()=>{y&&y()}),(O,N)=>{const H=j("router-view"),M=j("Loading"),R=ge;return E(),B("div",{class:Y(["app-layout",{"mobile-layout":T.value,"sidebar-collapsed":k.value}])},[T.value?(E(),B(pe,{key:1},[c(Re),p("main",ps,[p("div",fs,[c(H,null,{default:d(({Component:g,route:o})=>[c(xe,{name:"fade-slide",mode:"out-in",appear:""},{default:d(()=>[(E(),q(ee(g),{key:o.path,class:"page-component"}))]),_:2},1024)]),_:1})])]),c(ls,{onAddTask:m})],64)):(E(),B(pe,{key:0},[c(ts,{onAddTask:m,onCollapse:w}),p("div",cs,[c(Re),p("main",us,[p("div",ds,[c(H,null,{default:d(({Component:g,route:o})=>[c(xe,{name:"fade-slide",mode:"out-in",appear:""},{default:d(()=>[(E(),q(ee(g),{key:o.path,class:"page-component"}))]),_:2},1024)]),_:1})])])])],64)),S.value?(E(),B("div",hs,[c(R,{class:"loading-icon"},{default:d(()=>[c(M)]),_:1}),N[0]||(N[0]=p("p",null,"加载中...",-1))])):G("",!0),N[1]||(N[1]=p("div",{id:"message-container"},null,-1))],2)}}}),gs=we(ms,[["__scopeId","data-v-ddbcf318"]]),vs={id:"app"},_s=re({__name:"App",setup(s){const e=me(),t=ve(),a=Ie(),n=$(()=>e.path==="/login");return ne(async()=>{await t.initAuth(),a.initVersionCheck()}),(h,_)=>{const f=j("router-view");return E(),B("div",vs,[n.value?(E(),q(f,{key:0})):(E(),q(gs,{key:1}))])}}}),ws="modulepreload",ys=function(s,e){return new URL(s,e).href},Pe={},ie=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){const _=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),T=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));n=Promise.allSettled(t.map(k=>{if(k=ys(k,a),k in Pe)return;Pe[k]=!0;const S=k.endsWith(".css"),m=S?'[rel="stylesheet"]':"";if(!!a)for(let x=_.length-1;x>=0;x--){const y=_[x];if(y.href===k&&(!S||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${k}"]${m}`))return;const l=document.createElement("link");if(l.rel=S?"stylesheet":ws,S||(l.as="script"),l.crossOrigin="",l.href=k,T&&l.setAttribute("nonce",T),document.head.appendChild(l),S)return new Promise((x,y)=>{l.addEventListener("load",x),l.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${k}`)))})}))}function h(_){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=_,window.dispatchEvent(f),!f.defaultPrevented)throw _}return n.then(_=>{for(const f of _||[])f.status==="rejected"&&h(f.reason);return e().catch(h)})},ks=()=>ie(()=>import("./LoginView-BLLpdKs8.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),Ss=()=>ie(()=>import("./DashboardView-DNfkRuPT.js"),__vite__mapDeps([5,1,2,6,7]),import.meta.url),Es=()=>ie(()=>import("./TasksView-DAK15Kke.js"),__vite__mapDeps([8,1,2,9,10,11,4]),import.meta.url),Ts=()=>ie(()=>import("./UsersView-Cv0zb235.js"),__vite__mapDeps([12,1,2,13,10,4,7]),import.meta.url),bs=()=>ie(()=>import("./SettingsView-Bf4LItCj.js"),__vite__mapDeps([14,2,1,15,7,4,11]),import.meta.url),As=[{path:"/",redirect:"/dashboard"},{path:"/login",name:"Login",component:ks,meta:{title:oe.LOGIN,requiresAuth:!1,hideInMenu:!0}},{path:"/dashboard",name:"Dashboard",component:Ss,meta:{title:oe.DASHBOARD,requiresAuth:!0,icon:"Dashboard"}},{path:"/tasks",name:"Tasks",component:Es,meta:{title:oe.TASKS,requiresAuth:!0,icon:"List"}},{path:"/users",name:"Users",component:Ts,meta:{title:oe.USERS,requiresAuth:!0,icon:"User"}},{path:"/settings",name:"Settings",component:bs,meta:{title:oe.SETTINGS,requiresAuth:!0,icon:"Setting"}},{path:"/:pathMatch(.*)*",redirect:"/dashboard"}],Ce=Qe({history:Ze(),routes:As});Ce.beforeEach(async(s,e,t)=>{const a=ve();if(s.meta.title&&(document.title=`${s.meta.title} - 百度网盘自动转存`),s.meta.requiresAuth&&!a.isLoggedIn&&(await a.initAuth(),!a.isLoggedIn)){t({path:"/login",query:{redirect:s.fullPath}});return}if(s.path==="/login"&&a.isLoggedIn){t("/");return}t()});Ce.afterEach((s,e)=>{console.log(`导航到: ${s.path}`)});const Q=Xe(_s);for(const[s,e]of Object.entries(ut))Q.component(s,e);Q.use(dt);Q.use(wt);Q.use(Ce);Q.config.errorHandler=(s,e,t)=>{console.error("Vue全局错误:",s,t)};Q.config.warnHandler=(s,e,t)=>{console.warn("Vue警告:",s,t)};Q.mount("#app");console.log("百度网盘自动转存工具前端已启动");export{Ae as A,Ps as B,$s as R,we as _,Te as a,_e as b,Ie as c,Ue as d,L as e,xs as f,Rs as g,Ls as h,vt as i,P as j,ve as u};
