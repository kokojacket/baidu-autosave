import{b as H,i as W,_ as X}from"./index-BNn2tC2b.js";/* empty css                  *//* empty css                 *//* empty css                */import{y as Y,aA as Z,r as p,j as ee,z as f,A as r,B as t,R as a,J as o,P as c,u as v,K as se,I as k,O as d,al as q,Q as te,a6 as oe,E as ae,L as g}from"./vendor-OArhA24O.js";import{g as le,K as ne,z as re,A as ie,b as de,n as ue,e as ce,f as me,c as _e,p as ve,w as pe,x as fe,y as ke,j as i,i as B}from"./element-Ci-NFJgn.js";const ge={class:"users-view"},ye={class:"page-header"},we={class:"stats-section"},Ce={class:"stat-card"},be={class:"stat-content"},Ue={class:"stat-number"},xe={class:"stat-card"},Ee={class:"stat-content"},Ve={class:"stat-number"},$e={class:"stat-card"},Fe={class:"stat-content"},qe={class:"stat-number"},Be={class:"users-list"},he={class:"user-grid"},Te={class:"user-header"},De={class:"user-info"},Me={class:"username"},Ie={class:"user-actions"},ze={key:0,class:"user-quota"},Ne={class:"quota-info"},Re={class:"quota-value"},Se={key:1,class:"user-activity"},Ae={class:"activity-time"},Pe=Y({__name:"UsersView",setup(Le){const u=H(),{users:h,loading:T,userStats:b}=Z(u),_=p(!1),y=p(),m=p(null),U=p(!1),n=p({username:"",cookies:""}),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],cookies:[{required:!0,message:"请输入Cookies",trigger:"blur"},{min:100,message:"Cookies长度不能少于100字符",trigger:"blur"}]},M=async l=>{try{await u.switchUser(l),i.success(`已切换到用户：${l}`)}catch(e){i.error(`切换用户失败：${e}`)}},I=async l=>{m.value=l;try{const e=await u.getUserCookies(l.username);n.value={username:l.username,cookies:e||""}}catch(e){n.value={username:l.username,cookies:""},console.warn("无法加载用户cookies:",e)}_.value=!0},z=async l=>{try{await B.confirm(`确定要删除用户 ${l} 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await u.deleteUser(l),i.success("用户已删除")}catch(e){e!=="cancel"&&i.error(`删除用户失败：${e}`)}},N=async l=>{try{const e=await u.getUserCookies(l);B.alert(e,`用户 ${l} 的Cookies`,{confirmButtonText:"复制",callback:async()=>{try{await navigator.clipboard.writeText(e),i.success("Cookies已复制到剪贴板")}catch{i.warning("复制失败，请手动复制")}}})}catch(e){i.error(`获取Cookies失败：${e}`)}},R=async()=>{if(!(!y.value||!await y.value.validate().catch(()=>!1))){U.value=!0;try{m.value?(await u.updateUser({username:m.value.username,cookies:n.value.cookies}),i.success("用户信息已更新")):(await u.addUser(n.value),i.success("用户已添加")),_.value=!1,S()}catch(e){i.error(`操作失败：${e}`)}finally{U.value=!1}}},S=()=>{var l;m.value=null,n.value={username:"",cookies:""},(l=y.value)==null||l.resetFields()};return ee(async()=>{await u.init()}),(l,e)=>{const A=q("Plus"),E=de,w=le,V=ue,P=q("MoreFilled"),C=me,L=ce,j=_e,K=ve,J=re,$=ke,F=fe,O=pe,Q=ie,G=ne;return r(),f("div",ge,[t("div",ye,[e[6]||(e[6]=t("h1",{class:"page-title"},"用户管理",-1)),a(w,{type:"primary",onClick:e[0]||(e[0]=s=>_.value=!0)},{default:o(()=>[a(E,null,{default:o(()=>[a(A)]),_:1}),e[5]||(e[5]=d(" 添加用户 ",-1))]),_:1})]),t("div",we,[t("div",Ce,[t("div",be,[t("div",Ue,c(v(b).total),1),e[7]||(e[7]=t("div",{class:"stat-label"},"总用户数",-1))])]),t("div",xe,[t("div",Ee,[t("div",Ve,c(v(b).valid),1),e[8]||(e[8]=t("div",{class:"stat-label"},"有效用户",-1))])]),t("div",$e,[t("div",Fe,[t("div",qe,c(v(b).invalid),1),e[9]||(e[9]=t("div",{class:"stat-label"},"失效用户",-1))])])]),t("div",Be,[se((r(),k(J,null,{default:o(()=>[t("div",he,[(r(!0),f(te,null,oe(v(h),s=>(r(),f("div",{key:s.username,class:ae(["user-card",{"current-user":s.is_current,"invalid-user":s.cookies_valid===!1}])},[t("div",Te,[t("div",De,[t("h3",Me,c(s.username),1),s.is_current?(r(),k(V,{key:0,type:"success",size:"small"},{default:o(()=>[...e[10]||(e[10]=[d("当前用户",-1)])]),_:1})):s.cookies_valid===!1?(r(),k(V,{key:1,type:"danger",size:"small"},{default:o(()=>[...e[11]||(e[11]=[d("失效",-1)])]),_:1})):g("",!0)]),t("div",Ie,[a(j,{trigger:"click"},{dropdown:o(()=>[a(L,null,{default:o(()=>[s.is_current?g("",!0):(r(),k(C,{key:0,onClick:x=>M(s.username)},{default:o(()=>[...e[12]||(e[12]=[d(" 切换用户 ",-1)])]),_:1},8,["onClick"])),a(C,{onClick:x=>I(s)},{default:o(()=>[...e[13]||(e[13]=[d(" 编辑用户 ",-1)])]),_:1},8,["onClick"]),a(C,{onClick:x=>N(s.username)},{default:o(()=>[...e[14]||(e[14]=[d(" 查看Cookies ",-1)])]),_:1},8,["onClick"]),s.is_current?g("",!0):(r(),k(C,{key:1,onClick:x=>z(s.username),style:{color:"#f56c6c"}},{default:o(()=>[...e[15]||(e[15]=[d(" 删除用户 ",-1)])]),_:1},8,["onClick"]))]),_:2},1024)]),default:o(()=>[a(w,{type:"text"},{default:o(()=>[a(E,null,{default:o(()=>[a(P)]),_:1})]),_:1})]),_:2},1024)])]),s.quota?(r(),f("div",ze,[t("div",Ne,[e[16]||(e[16]=t("span",{class:"quota-label"},"存储空间：",-1)),t("span",Re,c(s.quota.used_formatted)+" / "+c(s.quota.total_formatted),1)]),a(K,{percentage:Math.round(s.quota.used/s.quota.total*100),"stroke-width":6,"show-text":!1},null,8,["percentage"])])):g("",!0),s.last_active?(r(),f("div",Se,[e[17]||(e[17]=t("span",{class:"activity-label"},"最后活跃：",-1)),t("span",Ae,c(v(W)(s.last_active)),1)])):g("",!0)],2))),128))])]),_:1})),[[G,v(T)]])]),a(Q,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),title:m.value?"编辑用户":"添加用户",width:"600px"},{footer:o(()=>[a(w,{onClick:e[3]||(e[3]=s=>_.value=!1)},{default:o(()=>[...e[19]||(e[19]=[d("取消",-1)])]),_:1}),a(w,{type:"primary",onClick:R,loading:U.value},{default:o(()=>[d(c(m.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:o(()=>[a(O,{ref_key:"userFormRef",ref:y,model:n.value,rules:D,"label-width":"100px"},{default:o(()=>[a(F,{label:"用户名",prop:"username"},{default:o(()=>[a($,{modelValue:n.value.username,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.username=s),placeholder:"请输入用户名",disabled:!!m.value},null,8,["modelValue","disabled"])]),_:1}),a(F,{label:"Cookies",prop:"cookies"},{default:o(()=>[a($,{modelValue:n.value.cookies,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.cookies=s),type:"textarea",rows:6,placeholder:"请输入百度网盘的Cookies..."},null,8,["modelValue"]),e[18]||(e[18]=t("div",{class:"form-help"}," 获取方法：打开百度网盘网页版，按F12打开开发者工具，在Network标签下找到任意请求，复制Cookies值 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),He=X(Pe,[["__scopeId","data-v-5abe88d8"]]);export{He as default};
