# ç™¾åº¦ç½‘ç›˜è‡ªåŠ¨è½¬å­˜

ä¸€ä¸ªåŸºäºFlaskçš„ç™¾åº¦ç½‘ç›˜è‡ªåŠ¨è½¬å­˜ç³»ç»Ÿï¼Œæ”¯æŒå¤šç”¨æˆ·ç®¡ç†ã€å®šæ—¶ä»»åŠ¡è°ƒåº¦å’Œé€šçŸ¥æ¨é€ã€‚

## ä¸»è¦ç‰¹æ€§

- ğŸ”„ è‡ªåŠ¨è½¬å­˜ï¼šæ”¯æŒè‡ªåŠ¨è½¬å­˜ç™¾åº¦ç½‘ç›˜åˆ†äº«é“¾æ¥åˆ°æŒ‡å®šç›®å½•
- ğŸ‘¥ å¤šç”¨æˆ·ç®¡ç†ï¼šæ”¯æŒæ·»åŠ å¤šä¸ªç™¾åº¦ç½‘ç›˜è´¦å·
- â° å®šæ—¶ä»»åŠ¡ï¼šæ”¯æŒå…¨å±€å®šæ—¶å’Œå•ä»»åŠ¡å®šæ—¶è§„åˆ™
- ğŸ“± æ¶ˆæ¯æ¨é€ï¼šæ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼ˆç›®å‰æ”¯æŒPushPlusï¼‰
- ğŸ¯ ä»»åŠ¡åˆ†ç±»ï¼šæ”¯æŒå¯¹ä»»åŠ¡è¿›è¡Œåˆ†ç±»ç®¡ç†
- ğŸ“Š çŠ¶æ€ç›‘æ§ï¼šå®æ—¶æ˜¾ç¤ºä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
- ğŸ” æ™ºèƒ½å»é‡ï¼šè‡ªåŠ¨è·³è¿‡å·²è½¬å­˜çš„æ–‡ä»¶
- ğŸ¨ ç¾è§‚ç•Œé¢ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®

## ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- Windows/Linux/MacOS

## å®‰è£…è¯´æ˜

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/your-username/baidu-autosave.git
cd baidu-autosave
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

3. è¿è¡Œåº”ç”¨ï¼š
```bash
python web_app.py
```

4. è®¿é—®Webç•Œé¢ï¼š
```
http://localhost:5000
```

## Docker éƒ¨ç½²

### ä½¿ç”¨ docker-compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š
```yaml
version: '3'

services:
  baidu-autosave:
    image: kokojacket/baidu-autosave:latest
    container_name: baidu-autosave
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      - ./config:/app/config
      - ./log:/app/log
    environment:
      - TZ=Asia/Shanghai
```

2. åˆ›å»ºå¿…è¦ç›®å½•ï¼š
```bash
mkdir -p config log
```

3. å¯åŠ¨æœåŠ¡ï¼š
```bash
docker-compose up -d
```

4. æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
docker-compose logs -f
```

5. è®¿é—®Webç•Œé¢ï¼š
```
http://localhost:5000
```

### ä½¿ç”¨ Docker CLI éƒ¨ç½²

1. åˆ›å»ºå¿…è¦ç›®å½•ï¼š
```bash
mkdir -p config log
```

2. å¯åŠ¨å®¹å™¨ï¼š
```bash
docker run -d \
  --name baidu-autosave \
  --restart unless-stopped \
  -p 5000:5000 \
  -v $(pwd)/config:/app/config \
  -v $(pwd)/log:/app/log \
  -e TZ=Asia/Shanghai \
  kokojacket/baidu-autosave:latest
```

3. æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
docker logs -f baidu-autosave
```

4. è®¿é—®Webç•Œé¢ï¼š
```
http://localhost:5000
```

### ç›®å½•ç»“æ„è¯´æ˜

```
baidu-autosave/
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config.json       # è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ config.template.json  # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ log/                  # æ—¥å¿—ç›®å½•
â”œâ”€â”€ Dockerfile           # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml   # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ web_app.py      # Webåº”ç”¨ä¸»ç¨‹åº
â”œâ”€â”€ storage.py      # å­˜å‚¨ç®¡ç†æ¨¡å—
â”œâ”€â”€ scheduler.py    # ä»»åŠ¡è°ƒåº¦æ¨¡å—
â”œâ”€â”€ utils.py        # å·¥å…·å‡½æ•°
â”œâ”€â”€ notify.py       # é€šçŸ¥æ¨¡å—
â””â”€â”€ templates/      # æ¨¡æ¿æ–‡ä»¶
    â””â”€â”€ index.html  # ä¸»é¡µé¢
```

### ä¸»è¦æ¨¡å—è¯´æ˜

- **web_app.py**: Webåº”ç”¨æ ¸å¿ƒï¼Œå¤„ç†HTTPè¯·æ±‚å’ŒWebSocketé€šä¿¡
- **storage.py**: ç®¡ç†ç™¾åº¦ç½‘ç›˜APIè°ƒç”¨å’Œæ•°æ®å­˜å‚¨
- **scheduler.py**: å¤„ç†å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ
- **notify.py**: å®ç°å„ç§é€šçŸ¥æ–¹å¼
- **utils.py**: æä¾›é€šç”¨å·¥å…·å‡½æ•°

## ä½¿ç”¨è¯´æ˜

### 1. æ·»åŠ ç”¨æˆ·

1. ç™»å½•ç™¾åº¦ç½‘ç›˜ç½‘é¡µç‰ˆ
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·è·å–cookies
3. åœ¨ç³»ç»Ÿä¸­æ·»åŠ ç”¨æˆ·ï¼Œå¡«å…¥cookies

### 2. æ·»åŠ ä»»åŠ¡

1. ç‚¹å‡»"æ·»åŠ ä»»åŠ¡"æŒ‰é’®
2. å¡«å†™ä»»åŠ¡ä¿¡æ¯ï¼š
   - ä»»åŠ¡åç§°ï¼ˆå¯é€‰ï¼‰
   - åˆ†äº«é“¾æ¥ï¼ˆå¿…å¡«ï¼‰
   - ä¿å­˜ç›®å½•ï¼ˆå¿…å¡«ï¼‰
   - å®šæ—¶è§„åˆ™ï¼ˆå¯é€‰ï¼‰
   - åˆ†ç±»ï¼ˆå¯é€‰ï¼‰

### 3. å®šæ—¶è®¾ç½®

- å…¨å±€å®šæ—¶è§„åˆ™ï¼šé€‚ç”¨äºæ‰€æœ‰æœªè®¾ç½®è‡ªå®šä¹‰å®šæ—¶çš„ä»»åŠ¡
- å•ä»»åŠ¡å®šæ—¶ï¼šå¯ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®ç‹¬ç«‹çš„å®šæ—¶è§„åˆ™
- å®šæ—¶è§„åˆ™ä½¿ç”¨cronè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š
  - `*/5 * * * *` : æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  - `0 */1 * * *` : æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
  - `0 8,12,18 * * *` : æ¯å¤©8ç‚¹ã€12ç‚¹ã€18ç‚¹æ‰§è¡Œ

### 4. é€šçŸ¥è®¾ç½®

ç›®å‰æ”¯æŒPushPlusæ¨é€æœåŠ¡ï¼š
1. è®¿é—® [pushplus.plus](http://www.pushplus.plus) è·å–Token
2. åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¡«å…¥Token
3. å¯é€‰å¡«å†™ç¾¤ç»„ç¼–ç ç”¨äºç¾¤å‘

## é…ç½®æ–‡ä»¶è¯´æ˜

`config.json` åŒ…å«ä»¥ä¸‹ä¸»è¦é…ç½®ï¼š

```json
{
    "baidu": {
        "users": {},          // ç”¨æˆ·ä¿¡æ¯
        "current_user": "",   // å½“å‰ç”¨æˆ·
        "tasks": []          // ä»»åŠ¡åˆ—è¡¨
    },
    "retry": {
        "max_attempts": 3,    // æœ€å¤§é‡è¯•æ¬¡æ•°
        "delay_seconds": 5    // é‡è¯•é—´éš”
    },
    "cron": {
        "default_schedule": [], // é»˜è®¤å®šæ—¶è§„åˆ™
        "auto_install": true    // è‡ªåŠ¨å¯åŠ¨å®šæ—¶
    },
    "notify": {
        "enabled": true,      // å¯ç”¨é€šçŸ¥
        "channels": {         // é€šçŸ¥æ¸ é“é…ç½®
            "pushplus": {
                "token": "",
                "topic": ""
            }
        }
    },
    "scheduler": {
        "max_workers": 1,     // æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°
        "misfire_grace_time": 3600,  // é”™è¿‡æ‰§è¡Œçš„å®¹é”™æ—¶é—´
        "coalesce": true      // åˆå¹¶æ‰§è¡Œé”™è¿‡çš„ä»»åŠ¡
    }
}
```

## å¸¸è§é—®é¢˜

1. **ä»»åŠ¡æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥åˆ†äº«é“¾æ¥æ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤è´¦å·ç™»å½•çŠ¶æ€
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—äº†è§£è¯¦ç»†åŸå› 

2. **å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ**
   - ç¡®è®¤å®šæ—¶è§„åˆ™æ ¼å¼æ­£ç¡®
   - æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦å‡†ç¡®
   - æŸ¥çœ‹è°ƒåº¦å™¨æ—¥å¿—

3. **é€šçŸ¥æ¨é€å¤±è´¥**
   - éªŒè¯PushPlus Tokenæ˜¯å¦æ­£ç¡®
   - æµ‹è¯•é€šçŸ¥åŠŸèƒ½
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

## å¼€å‘è¯´æ˜

### ä¸»è¦æ¨¡å—è¯´æ˜

- **web_app.py**: Webåº”ç”¨æ ¸å¿ƒï¼Œå¤„ç†HTTPè¯·æ±‚å’ŒWebSocketé€šä¿¡
- **storage.py**: ç®¡ç†ç™¾åº¦ç½‘ç›˜APIè°ƒç”¨å’Œæ•°æ®å­˜å‚¨
- **scheduler.py**: å¤„ç†å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦å’Œæ‰§è¡Œ
- **notify.py**: å®ç°å„ç§é€šçŸ¥æ–¹å¼
- **utils.py**: æä¾›é€šç”¨å·¥å…·å‡½æ•°

## æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®ç°åŸºæœ¬åŠŸèƒ½ï¼šä»»åŠ¡ç®¡ç†ã€å®šæ—¶æ‰§è¡Œã€é€šçŸ¥æ¨é€

## è®¸å¯è¯

MIT License

## è‡´è°¢

- [Flask](https://flask.palletsprojects.com/)
- [APScheduler](https://apscheduler.readthedocs.io/)
- [baidupcs-py](https://github.com/PeterDing/BaiduPCS-Py)